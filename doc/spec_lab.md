# Универсальная спецификация лабораторных задач (spec_lab)

Этот документ определяет требования к лабораторным задачам курса.  
Спецификация является универсальной и применяется к задачам по различным технологиям  
(ORM, frontend, backend, фреймворки, алгоритмы и т.д.).

---

## 0. Назначение документа

Spec_lab описывает:
- требования к формулировке задачи;
- требования к тестированию;
- требования к архитектуре решения;
- ограничения на структуру проекта;
- критерии качества лабораторной.

Документ не описывает конкретную технологию и не зависит от неё.

---

## 1. Общие принципы

1. Каждая задача должна быть автономной и не зависеть от состояния других задач.
2. Задача должна полностью проверяться автоматическими тестами.
3. Решение должно изменять только указанный файл (если не указано иное).
4. Требования задачи должны быть проверяемыми тестами.
5. Задача должна вводить ровно одно новое ключевое действие или концепцию.

---

## 2. Структура задачи

Каждая лабораторная должна включать:

- README.md — контракт задачи;
- schema.ts (или иной файл решения);
- *.spec.ts — автотесты.

README.md содержит:
- цель задачи;
- тип задачи;
- формулировку задания;
- ограничения;
- проверяемые требования.

README.md не должен:
- описывать тестирование;
- содержать код решения;
- содержать непроверяемые требования.

---

## 3. Требования к тестам

1. Тесты должны быть детерминированы.
2. Тесты не должны зависеть от внешних сервисов.
3. Тесты не должны зависеть от порядка выполнения.
4. Тесты не должны зависеть от скрытого состояния модулей.
5. Если используется module-level state, тест обязан сбрасывать его (например, через resetModules).
6. Тесты должны проверять фактическое поведение, а не текст исходного файла.

Запрещено:
- проверять наличие строк ("use server") через анализ текста;
- проверять внутренние вызовы через spy на экспорт в ESM;
- полагаться на побочные эффекты вне контролируемого контекста.

---

## 4. Принцип dependency injection

Для обеспечения тестируемости:

- зависимости должны передаваться через параметры функции;
- запрещено импортировать глобальные зависимости внутри решения;
- запрещено использовать скрытые глобальные состояния;
- запрещено дублировать логику при переиспользовании функций.

Любая задача архитектурного уровня должна использовать DI-модель.

---

## 5. Новое действие (progression rule)

Каждая лабораторная задача должна:

- вводить одно новое действие или концепцию;
- не требовать одновременного изучения нескольких новых механизмов;
- логически продолжать предыдущую задачу.

Недопустимо:
- повторять уже изученное без нового аспекта;
- объединять несколько новых тем в одной задаче.

---

## 6. Требования к сложности решения

Решение задачи должно:

- занимать 2–10 строк осмысленного кода;
- содержать минимум два логических действия (если это не базовая вводная задача);
- не сводиться к простому прокидыванию вызова без обработки.

Исключения возможны только для самых первых задач курса.

---

## 7. Работа с ошибками и edge-cases

Если задача предполагает:

- асинхронность;
- обработку ошибок;
- fallback-логику;
- условную ветвизацию;

то соответствующие ветви должны проверяться тестами.

Запрещено:
- проглатывать ошибки;
- использовать try/catch без повторного выброса ошибки (если это не указано явно);
- оставлять непроверенные ветви поведения.

---

## 8. Работа с состоянием

Если задача использует:

- singleton;
- cache;
- module-level переменные;

то:

- состояние должно быть явно управляемым;
- тесты обязаны изолировать модуль;
- задача не должна зависеть от порядка выполнения тестов.

---

## 9. Универсальность технологии

Spec_lab применяется к:

- ORM;
- frontend-компонентам;
- backend-логике;
- алгоритмическим задачам;
- архитектурным упражнениям.

Поэтому:

- нельзя ссылаться на конкретные фреймворки в общих правилах;
- технологические детали должны находиться в README конкретной задачи;
- спецификация остаётся абстрактной и технологически нейтральной.

---

## 10. Критерии качества лабораторной

Лабораторная считается корректной, если:

- невозможно пройти тесты без реализации логики;
- тесты не зависят от порядка;
- все требования проверяемы;
- отсутствуют непроверяемые педагогические формулировки;
- решение демонстрирует именно изучаемую концепцию.

Любая задача должна проходить формальный аудит на edge-cases.