# Курс: Drizzle ORM для Next.js (T3 Stack)

## Общая информация

- Формат: 4 лекции по 2 академических часа
- Уровень: студенты ВУЗа, базовые знания TypeScript и Prisma
- Контекст: Next.js (App Router), T3 Stack
- База данных: PostgreSQL (Docker)
- ORM: Drizzle ORM
- Цель курса: освоить Drizzle ORM как типобезопасный SQL-first слой доступа к данным
- Не входит в курс: tRPC, авторизация (будут изучаться позже)

---

## Лекция 1. Drizzle ORM: философия и основы schema-first подхода

**Цель лекции:**  
Сформировать понимание архитектуры Drizzle ORM, его отличий от Prisma и принципов schema-first подхода.

### План лекции

1. Место Drizzle ORM в backend-архитектуре приложения  
   - ORM как слой доступа к данным  
   - Drizzle в сравнении с Prisma (thin ORM, отсутствие client generation)

2. Философия Drizzle ORM  
   - SQL-first подход  
   - Минимальный уровень абстракции  
   - Предсказуемость и контроль над запросами

3. Поддерживаемые базы данных и окружения  
   - PostgreSQL, SQLite, MySQL  
   - Node.js и serverless окружения  
   - Выбор PostgreSQL для учебного курса

4. Schema-first подход  
   - Описание схемы БД в TypeScript  
   - Связь схемы и SQL  
   - Явное моделирование структуры данных

5. Описание таблиц в Drizzle  
   - Колонки и типы данных  
   - primary key  
   - nullable и default значения

6. Типизация данных  
   - Вывод типов из схемы  
   - Различие insert и select моделей  
   - Типобезопасность на этапе компиляции

7. Работа с drizzle-kit  
   - Назначение инструмента  
   - Генерация SQL  
   - Применение схемы к базе данных

8. Организация проекта с Drizzle  
   - db/schema  
   - db/client  
   - принципы структурирования кода

9. Обзор базовых запросов  
   - insert  
   - select  
   - соответствие SQL-запросам

---

## Лекция 2. CRUD и запросы в Drizzle ORM

**Цель лекции:**  
Научить читать и писать основные запросы в Drizzle ORM и понимать их связь с SQL.

### План лекции

1. CRUD как базовая модель работы с данными  
   - Create, Read, Update, Delete  
   - Соответствие SQL-операциям

2. Insert-запросы  
   - Добавление одной записи  
   - Возврат вставленных данных  
   - Типизация входных параметров

3. Select-запросы  
   - Получение всех записей  
   - Получение одной записи  
   - Ограничение набора полей

4. Условия выборки (where)  
   - equals  
   - like  
   - in  
   - композиция условий

5. Сортировка и ограничение выборки  
   - orderBy  
   - limit  
   - offset

6. Update-запросы  
   - Частичное обновление данных  
   - Обновление по условию  
   - Типизация обновляемых полей

7. Delete-запросы  
   - Удаление по идентификатору  
   - Удаление по условию  
   - Риски массового удаления

8. Агрегатные функции  
   - count  
   - avg  
   - sum  
   - Практические сценарии использования

9. Типизация результатов запросов  
   - Inferred types  
   - Защита от runtime-ошибок

---

## Лекция 3. Связи, JOIN и транзакции

**Цель лекции:**  
Научить моделировать связанные данные и выполнять сложные SQL-запросы с использованием Drizzle ORM.

### План лекции

1. Связанные данные в реляционных БД  
   - Зачем нужны связи  
   - Примеры из реальных систем

2. Типы связей  
   - one-to-one  
   - one-to-many  
   - many-to-many

3. Внешние ключи  
   - Назначение foreign key  
   - Влияние на целостность данных

4. JOIN в SQL  
   - inner join  
   - left join  
   - Семантика объединения таблиц

5. JOIN в Drizzle ORM  
   - Синтаксис  
   - Типизация результатов

6. Many-to-many через промежуточную таблицу  
   - Роль связующей таблицы  
   - Практические примеры

7. Агрегации по связанным данным  
   - Подсчёты  
   - Средние значения  
   - Группировка

8. Транзакции  
   - Понятие транзакции  
   - Когда транзакции необходимы

9. Использование транзакций в Drizzle  
   - Commit и rollback  
   - Обзор API

---

## Лекция 4. Использование Drizzle ORM в Next.js

**Цель лекции:**  
Показать корректное и безопасное использование Drizzle ORM в серверной части Next.js-приложения.

### План лекции

1. Использование Drizzle ORM в Next.js  
   - Server-only код  
   - Запрет использования на клиенте

2. Инициализация подключения к базе данных  
   - Singleton-подход  
   - Работа с переменными окружения

3. Организация слоя доступа к данным  
   - Выделение data-access слоя  
   - Разделение ответственности

4. Server Actions и работа с базой данных  
   - Выполнение запросов  
   - Типизация входных и выходных данных

5. Использование Drizzle в Server Components  
   - Загрузка данных  
   - Повторное использование запросов

6. Обработка ошибок базы данных  
   - Ошибки уникальности  
   - Обработка отсутствующих данных

7. Производительность и подключения  
   - Особенности работы в dev-режиме  
   - Подключения в serverless окружениях

8. Безопасность  
   - SQL injection  
   - Prepared statements в Drizzle

9. Итоговая архитектура приложения  
   - UI → Server Actions → Data-access → Drizzle ORM

---
