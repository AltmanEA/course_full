---
title: tRPC –≤ Next.js ‚Äî –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–ª–æ–π –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
name: trpc-client
canvasWidth: 800
routerMode: hash
---
<style>
.lab-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    background: #eef2ff;
    color: #3730a3;
    font-weight: 600;
    font-size: 0.9em;
}
.mermaid-fit {
  transform: scale(0.7);
  transform-origin: top center;
}
</style>

# tRPC –≤ Next.js ‚Äî –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–ª–æ–π –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å

---

# –¶–µ–ª—å –ª–µ–∫—Ü–∏–∏

- –ü–æ–Ω—è—Ç—å, –∫–∞–∫ router –ø–æ—Ä–æ–∂–¥–∞–µ—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ hooks
- –û—Å–≤–æ–∏—Ç—å useQuery –∏ useMutation
- –†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å cache –∏ invalidate
- –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–ª–æ—è
- –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω—É—é –º–æ–¥–µ–ª—å client data-flow

---

# –û—Ç API –∫ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º—É data-flow

–õ–µ–∫—Ü–∏–∏ 1‚Äì3:

- –∫–æ–Ω—Ç—Ä–∞–∫—Ç
- CRUD
- middleware
- –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ API

–õ–µ–∫—Ü–∏—è 4:

- –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —ç—Ç–∏–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º
- –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è

---

# Router –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ hooks

Router:

- –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç namespace
- –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç input/output
- –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏—é

Client –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ hooks.

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è.

---

# –ü–µ—Ä–≤—ã–π useQuery

<span class="lab-badge">üß™ trpc31</span>

```ts
const { data, isLoading } =
  trpc.user.getById.useQuery({
    id: '1'
  })
```

- —Ç–∏–ø input –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
- —Ç–∏–ø data –≤—ã–≤–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

End-to-end —Ç–∏–ø–∏–∑–∞—Ü–∏—è.

---

# useQuery ‚Äî —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

- —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è query key
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å
- —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
- –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ –±–µ—Ä—ë—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ cache

React Query —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.

---

# useQuery —Å input

<span class="lab-badge">üß™ trpc32</span>

Input ‚Äî —á–∞—Å—Ç—å –∫–ª—é—á–∞ –∫—ç—à–∞.

```ts
trpc.post.getById.useQuery({
  id: '42'
})
```

–†–∞–∑–Ω—ã–µ input ‚Üí —Ä–∞–∑–Ω—ã–µ cache-–∑–∞–ø–∏—Å–∏.

---

# useMutation ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

Mutation:

- –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ query
- –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç side-effect
- —Ç—Ä–µ–±—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ cache

---

# –ü–µ—Ä–≤—ã–π useMutation

<span class="lab-badge">üß™ trpc33</span>

```ts
const mutation =
  trpc.user.create.useMutation()

mutation.mutate({
  name: 'Alice'
})
```

Mutation –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç query –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

# –ü—Ä–æ–±–ª–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–ü–æ—Å–ª–µ mutation:

- —Å–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª—ë–Ω
- –∫—ç—à –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º

–ù—É–∂–Ω–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è.

---

# invalidate

<span class="lab-badge">üß™ trpc34</span>

```ts
const utils = trpc.useUtils()

mutation.mutate(input, {
  onSuccess: () => {
    utils.user.getById.invalidate({ id })
  }
})
```

Invalidate ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è UI.

---

# onSuccess ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–æ–ª—å

onSuccess:

- –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç post-mutation –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –Ω–µ —Å–º–µ—à–∏–≤–∞–µ—Ç UI –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç data-flow

---

# onSuccess

<span class="lab-badge">üß™ trpc35</span>

```ts
trpc.user.update.useMutation({
  onSuccess: () => {
    utils.user.getById.invalidate()
  }
})
```

Mutation —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏–µ–π —Å–∏—Å—Ç–µ–º—ã.

---

# onError

<span class="lab-badge">üß™ trpc36</span>

```ts
trpc.user.create.useMutation({
  onError: (error) => {
    console.error(error.message)
  }
})
```

–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

API –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º.

---

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ hooks –ø–æ –¥–æ–º–µ–Ω–∞–º

–ü–ª–æ—Ö–æ:

- –≤—Å–µ –≤—ã–∑–æ–≤—ã –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- —Ö–∞–æ—Ç–∏—á–Ω—ã–π –∏–º–ø–æ—Ä—Ç

–•–æ—Ä–æ—à–æ:

- userHooks
- postHooks
- –¥–æ–º–µ–Ω–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è

---

# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ hooks

<span class="lab-badge">üß™ trpc37</span>

```ts
export const userHooks = {
  useGetById: () =>
    trpc.user.getById.useQuery(),
}
```

–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–ª–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç—Å—è.

---

# –ö–æ–º–ø–æ–∑–∏—Ü–∏—è hooks

<span class="lab-badge">üß™ trpc38</span>

```ts
export const api = {
  user: userHooks,
  post: postHooks
}
```

–ü–æ–≤—Ç–æ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É router.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å–∏–º–º–µ—Ç—Ä–∏—è.

---

# –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç

<span class="lab-badge">üß™ trpc39</span>

```ts
export * from './userHooks'
export * from './postHooks'
```

–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞.

–£–ø—Ä–æ—â–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞.

---

# –ü–æ–ª–Ω—ã–π client data-flow

```mermaid
flowchart LR
    A[UI Component]
    B[useQuery / useMutation]
    C[tRPC Client]
    D[Router]
    E[Access Layer]
    F[(Database)]

    A --> B
    B --> C
    C --> D
    D --> E
    E --> F
    F --> E
    E --> D
    D --> C
    C --> B
    B --> A
```

–¢–∏–ø–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –≤—Å–µ —É—Ä–æ–≤–Ω–∏.

---

# –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª

<span class="lab-badge">üß™ trpc40</span>

1. useQuery –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ  
2. useMutation –∏–∑–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ  
3. onSuccess –≤—ã–∑—ã–≤–∞–µ—Ç invalidate  
4. query –ø–µ—Ä–µ–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è  
5. UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è  

–≠—Ç–æ –∑–∞–º–∫–Ω—É—Ç—ã–π —Ü–∏–∫–ª.

---

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–ª–æ—è

- –ö–æ–Ω—Ç—Ä–∞–∫—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è router
- Hooks –ø–æ–≤—Ç–æ—Ä—è—é—Ç –¥–æ–º–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è ‚Äî —á–∞—Å—Ç—å data-flow
- UI –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ API
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ

---

# –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã

‚ùå –ü—Ä—è–º–æ–π fetch –≤–º–µ—Å—Ç–æ tRPC  
‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤  
‚ùå –ì–ª–æ–±–∞–ª—å–Ω—ã–π invalidate –±–µ–∑ scope  
‚ùå –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ onSuccess  
‚ùå –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ hooks  

---

# –°–≤—è–∑—å —Å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–º–∏ (trpc31‚Äìtrpc40)

–í—ã —Ä–µ–∞–ª–∏–∑—É–µ—Ç–µ:

1. useQuery  
2. useQuery —Å input  
3. useMutation  
4. invalidate  
5. onSuccess  
6. onError  
7. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ hooks  
8. –ö–æ–º–ø–æ–∑–∏—Ü–∏—é  
9. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç  
10. –ü–æ–ª–Ω—ã–π client data-flow  

–õ–µ–∫—Ü–∏—è –æ–±—ä—è—Å–Ω—è–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.  
–ü—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö.

---

# –ò—Ç–æ–≥

–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–ª–æ–π:

- —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω
- —Å–∏–º–º–µ—Ç—Ä–∏—á–µ–Ω router
- —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫—ç—à–µ–º
- –∫–æ–º–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω
- –∑–∞–º—ã–∫–∞–µ—Ç –ø–æ–ª–Ω—ã–π data-flow —Å–∏—Å—Ç–µ–º—ã

tRPC —Å–≤—è–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç –≤ –µ–¥–∏–Ω—ã–π —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—É—Ä.
